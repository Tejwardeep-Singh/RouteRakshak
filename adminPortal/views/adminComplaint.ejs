
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
    <link rel="stylesheet" href="/css/style.css">
    <title>Route Rakshak | Admin </title>
</head>
<body>
    <main>
        <nav>
            <div class="menu-toggle" onclick="toggleMenu()">
                ‚ò∞
            </div>
            <div class="logo"><img src="/images/logo.png" alt="">Route Rakshak</div>
            <div class="nr" id="navLinks">
                <a href="/admin">Home</a>
                <a href="/admin/dashboard">Dashboard</a>
                <a href="/admin/logout">Logout</a>
            </div>
        </nav>
        <section class="admin-complaint-section">

    <div class="admin-header">
        <h1>Ward <%= ward.wardNumber %> Complaints</h1>
        <p>Monitor and manage reported issues</p>
    </div>

    <div class="admin-content">


        <div class="admin-map-container">
            <div id="map"></div>
        </div>


        <div class="admin-complaint-list">

            <% if (complaints2.length === 0) { %>
                <div class="empty-state">
                    <div class="empty-icon">üì≠</div>
                    <h3>No Complaints Found</h3>
                    <p>This ward currently has no reported issues.</p>
                    <span class="empty-subtext">Everything looks good here üëå</span>
                </div>
            <% } %>

            <% complaints2.forEach(complaint => { %>
                <div class="admin-complaint-card">

                    <div class="card-header">
                        <h3><%= complaint.locationText %></h3>
                        <span class="status-badge <%= complaint.status %>">
                            <%= complaint.status %>
                        </span>
                    </div>

                    <p class="card-message">
                        <%= complaint.message %>
                    </p>

                    <a href="/admin/complaint/<%= complaint._id %>" class="view-link">
                        View Details ‚Üí
                    </a>

                </div>
            <% }) %>

        </div>

    </div>

</section>

         <div id="copywright">
            <p>&copy; <span id="year"></span> ATES Squad. All rights reserved.</p>
        </div>
    </main>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script id="wardData" type="application/json">
        <%- JSON.stringify(ward.geometry) %>
    </script>
    <script id="complaintsData" type="application/json">
            <%- JSON.stringify(complaints) %>
    </script>

    <script>
    const map = L.map('map').setView([31.6340, 74.8723], 12);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18
    }).addTo(map);

    const wardGeoJSON = JSON.parse(
        document.getElementById("wardData").textContent
    );

    
    const wardLayer = L.geoJSON(wardGeoJSON, {
    style: {
        color: "#111",
        weight: 3,
        fillOpacity: 0.3
    }
}).addTo(map);

map.fitBounds(wardLayer.getBounds());

    const complaintsData = JSON.parse(
        document.getElementById("complaintsData").textContent
    );

    complaintsData.forEach(c => {

        if (!c.location || !c.location.coordinates) return;

        const lng = c.location.coordinates[0];
        const lat = c.location.coordinates[1];

        let color = "red";
        if (c.status === "resolved") color = "orange";
        if (c.status === "completed") color = "green";

        const marker = L.circleMarker([lat, lng], {
            radius: 4,
            color: color,
            fillColor: color,
            fillOpacity: 0.9,
  weight: 2
        }).addTo(map);

        marker.bindPopup(`
            <strong>${c.locationText || "Complaint"}</strong><br>
            Status: ${c.status}
        `);
    });
    const legend = L.control({ position: "bottomright" });
    legend.onAdd = function () {
    const div = L.DomUtil.create("div", "info legend");

    div.innerHTML = `
        <strong>Status</strong><br>
        <span style="color:red;">‚óè</span> Pending<br>
        <span style="color:orange;">‚óè</span> Resolved<br>
        <span style="color:green;">‚óè</span> Completed
    `;

    div.style.background = "white";
    div.style.padding = "10px";
    div.style.borderRadius = "8px";

    return div;
    };

legend.addTo(map);

    </script>
    <script>
        const currentYear = new Date().getFullYear();
        document.getElementById('year').textContent = currentYear;
    </script>
    
    <script src="/js/script.js"></script>
</body>
</html>
        