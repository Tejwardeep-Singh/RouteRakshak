<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
    <link rel="stylesheet" href="/css/style.css">
    <title>Route Rakshak | Citizen </title>
</head>
<body>
    <main>
        <nav>
            <div class="menu-toggle" onclick="toggleMenu()">
                ‚ò∞
            </div>
            <div class="logo"><img src="/images/logo.png" alt="">Route Rakshak</div>
            <div class="nr" id="navLinks">
                <a href="/">Home</a>
                <a href="/citizenComplaint">Complaint</a>
                <a href="/logout">Logout</a>
                <a href="/map">Maps</a>
            </div>
        </nav>
        <section class="citizen-hero">
            <div class="hero-inner">
                <h1>Citizen Dashboard</h1>
                <p>Welcome <strong><%= citizen.name %></strong></p>

                <div class="hero-rank ward-edit-wrapper">
                    Ward: 
                    <span id="currentWard"><%= ward.wardNumber %></span>
                    <span class="edit-ward-icon" onclick="openWardModal()">‚úèÔ∏è</span>
                </div>
            </div>
        </section>

        <section class="stats-section">
            <div class="stats-header">
                <h2>Ward Performance Overview</h2>
                <p>Your ward performance at a glance</p>
            </div>

            <div class="stats-grid">

                <div class="stat-card highlight-card">
                    <div class="stat-icon">üèÜ</div>
                    <h3>Ward Rank</h3>
                    <p>#<%= ward.rank %></p>
                    <a href="/leaderboard" class="stat-link">View All Ranks ‚Üí</a>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <h3>Total Ward Complaints</h3>
                    <p><%= yourComplaints.length %></p>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">‚è≥</div>
                    <h3>Pending</h3>
                    <p><%= pendingCount %></p>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <h3>Completed</h3>
                    <p><%= completedCount %></p>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">üôã</div>
                    <h3>Your Complaints</h3>
                    <p><%= ward.complaintsCount  %></p>
                </div>

            </div>

        </section>
        <section class="complaints-section">
            <h2>Your Complaints</h2>

            <div class="complaints-grid">
                <% yourComplaints.forEach(complaint => { %>

                <div class="complaint-card">

                    <div class="complaint-header">
                        <span><strong>Location:</strong> <%= complaint.locationText %></span>
                        <span class="status <%= complaint.status %>">
                            <%= complaint.status %>
                        </span>
                    </div>

                    <p class="message"><%= complaint.message %></p>

                    <div class="image-row">
                        <img src="<%= complaint.beforeImage %>">

                        <% if (complaint.status === "resolved") { %>
                            <img src="<%= complaint.afterImage %>">
                        <% } %>
                    </div>

                    <% if (complaint.status === "resolved") { %>
                        <form action="/verify/<%= complaint._id %>" method="POST">
                            <button class="verify-btn">Verify Completion</button>
                        </form>
                    <% } %>

                    <% if (complaint.status === "completed") { %>
                        <p class="verified">‚úî Verified & Completed</p>
                    <% } %>

                </div>

                <% }) %>
            </div>
        </section>
        <div id="copywright">
            <p>&copy; <span id="year"></span> ATES Squad. All rights reserved.</p>
        </div>



        
        <div id="wardModal" class="modal-overlay">
            <div class="modal-container">

                <div class="modal-header">
                    <h2>Change Residential Ward</h2>
                    <span class="close-modal" onclick="closeWardModal()">‚úñ</span>
                </div>

                <div class="modal-body">
                    <p><strong>Current Ward:</strong> <span id="modalCurrentWard"><%= ward.wardNumber %></span></p>

                    <div id="detectingText">
                        Detecting your live location...
                    </div>

                    <p id="detectedWardResult" class="detected-ward"></p>
                    <p id="wardError" class="ward-error"></p>
                </div>

                <div class="modal-footer">
                    <button class="modal-btn cancel-btn" onclick="closeWardModal()">Close</button>
                    <button class="modal-btn confirm-btn" id="confirmWardBtn" disabled onclick="confirmWard()">Confirm</button>
                </div>

            </div>
        </div>
    </main>
    <script>
        const currentYear = new Date().getFullYear();
        document.getElementById('year').textContent = currentYear;
    </script>
    <script src="/js/script.js"></script>
</body>
</html>